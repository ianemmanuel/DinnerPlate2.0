
generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
}

//*-----------------------ENUMS-------------------

enum VendorStatus {
  ACTIVE
  SUSPENDED
  BANNED
}

enum VendorTypeStatus {
  ACTIVE
  SUSPENDED
}

enum VendorApplicationStatus {
  DRAFT
  SUBMITTED
  UNDER_REVIEW
  APPROVED
  REJECTED
}


enum OutletAdminStatus {
  ACTIVE
  SUSPENDED
  BANNED
}

enum StaffRole {
  OWNER
  ADMIN
  MANAGER
  CHEF
  STAFF
}

enum DocumentScope {
  VENDOR
  OUTLET
}

enum DocumentStatus {
  PENDING
  APPROVED
  REJECTED
  EXPIRED
  SUPERSEDED
  WITHDRAWN
}

enum DayOfWeek {
  MONDAY
  TUESDAY
  WEDNESDAY
  THURSDAY
  FRIDAY
  SATURDAY
  SUNDAY
}

enum GeoStatus {
  ACTIVE
  INACTIVE
}

enum OutletAdminActionType {
  CREATED
  UPDATED
  SUSPENDED
  UNSUSPENDED
  BANNED
  UNBANNED
  FEATURED
  UNFEATURED
}

enum CuisineStatus {
  ACTIVE
  SUSPENDED
  DEPRECATED
}

enum PayoutMethod {
  BANK_TRANSFER
  MOBILE_MONEY
  PAYPAL
  STRIPE
}

enum PayoutTypeStatus {
  ACTIVE
  SUSPENDED
}

enum MealStatus {
  ACTIVE
  SUSPENDED
  BANNED
}

enum DocumentTypeStatus {
  ACTIVE
  INACTIVE
  DEPRECATED
  ARCHIVED
}


//*----------------------USERS/ADMINS/COURIORS/VENDORS-------------------------

model VendorUser {
  id        String   @id @default(uuid())
  clerkId   String   @unique
  email     String   @unique

  vendorAccount VendorAccount?
  applications  VendorApplication[]

  createdAt DateTime @default(now())
}

model ConsumerAccount {
  id        String   @id @default(uuid())
  clerkId   String   @unique
  email     String   @unique

  createdAt DateTime @default(now())
}

model AdminUser {
  id                             String                 @id @default(uuid())
  email                          String                 @unique
  passwordHash                   String
  countryPayoutTypesCreated      CountryPayoutType[]    @relation("CountryPayoutTypeCreatedBy")
  countryPayoutTypesUpdated      CountryPayoutType[]    @relation("CountryPayoutTypeUpdatedBy")
  payoutTypesCreated             PayoutType[]           @relation("PayoutTypeCreatedBy")
  payoutTypesUpdated             PayoutType[]           @relation("PayoutTypeUpdatedBy")
  vendorTypesCreated             VendorType[]           @relation("VendorTypeCreatedBy")
  vendorTypesUpdated             VendorType[]           @relation("VendorTypeUpdatedBy")
  reviewedVendorDocuments        VendorDocument[]       @relation("VendorDocumentReviewedBy")
  updatedOutlets                 Outlet[]               @relation("OutletUpdatedByAdmin")
  updatedMeals                   Meal[]                 @relation("MealAdminUpdatedBy")
  updatedMealplans               MealPlan[]             @relation("MealPlanAdminUpdatedBy")
  createdCuisines                Cuisine[]              @relation("CuisineCreatedBy")
  updatedCuisines                Cuisine[]              @relation("CuisineUpdatedBy")
  createdCountries               Country[]              @relation("CountryCreatedBy")
  updatedCountries               Country[]              @relation("CountryUpdatedBy")
  createdCities                  City[]                 @relation("CityCreatedBy")
  updatedCities                  City[]                 @relation("CityUpdatedBy")
  createdServiceAreas            ServiceArea[]          @relation("ServiceAreaCreatedBy")
  updatedServiceAreas            ServiceArea[]          @relation("ServiceAreaUpdatedBy")
  createdVendorTypeCountry       VendorTypeCountry[]    @relation("VendorTypeCountryCreatedBy")
  updatedVendorTypeCountry       VendorTypeCountry[]    @relation("VendorTypeCountryUpdatedBy")
  createdDocumentType            DocumentTypeConfig[]   @relation("DocumentTypeUpdatedBy")
  updatedDocumentType            DocumentTypeConfig[]   @relation("DocumentTypeCreatedBy")
  reviewedOutletDocument         OutletDocument[]       @relation("OutletDocumentReviewedBy)
 

  createdAt                      DateTime             @default(now())
}


//*---------------------MEALS/MEAL-PLANS/CUISINES/CATEGORIES--------------

model Meal {
  id                String        @id @default(uuid())
  outlet            Outlet        @relation(fields: [outletId], references: [id], onDelete: Cascade)
  outletId          String
  name              String
  description       String?
  price             Float
  mainImage         String?
  images            String[]
  portionSize       String?       // e.g., "500g", "1 plate", etc.
  dietaryOptions    String[]      // optional, can evolve into table later
  specialties       String[]      // optional

  //* ---------------- Admin Control ----------------
  adminStatus       MealStatus     @default(ACTIVE)
  adminSuspendedAt  DateTime?
  adminBannedAt     DateTime?
  adminUpdatedAt    DateTime?
  adminUpdatedById  String?
  adminUpdatedBy    AdminUser?    @relation("MealAdminUpdatedBy", fields: [adminUpdatedById], references: [id])

  //* ---------------- Vendor Control ----------------
  deletedAt         DateTime?
  vendorUpdatedAt   DateTime?

  cuisines          MealCuisine[]
  mealPlans         MealPlanMeal[]

  createdAt         DateTime      @default(now())
  updatedAt         DateTime      @updatedAt

  @@unique([outletId, name])
  @@index([outletId])
  @@index([adminStatus])
  @@index([deletedAt])
  @@index([createdAt])
}

model MealPlan {
  id                String        @id @default(uuid())
  outlet            Outlet        @relation(fields: [outletId], references: [id], onDelete: Cascade)
  outletId          String
  name              String
  description       String?
  price             Float?   
  images            String[]
  isPublished       Boolean       @default(false)
  isFeatured        Boolean       @default(false)

  //* ---------------- Admin Control ----------------
  adminStatus       MealStatus     @default(ACTIVE)
  adminSuspendedAt  DateTime?
  adminBannedAt     DateTime?
  adminUpdatedAt    DateTime?
  adminUpdatedById  String?
  adminUpdatedBy    AdminUser?    @relation("MealPlanAdminUpdatedBy", fields: [adminUpdatedById], references: [id])


  deletedAt         DateTime?
  vendorUpdatedAt   DateTime?
  meals             MealPlanMeal[]

  createdAt         DateTime      @default(now())
  updatedAt         DateTime      @updatedAt

  @@unique([outletId, name])
  @@index([outletId])
  @@index([adminStatus])
  @@index([deletedAt])
  @@index([createdAt])
}

model MealCuisine {
  mealId    String
  cuisineId String
  meal      Meal     @relation(fields: [mealId], references: [id], onDelete: Cascade)
  cuisine   Cuisine  @relation(fields: [cuisineId], references: [id], onDelete: Cascade)

  @@id([mealId, cuisineId])
  @@index([cuisineId])
}

model MealPlanMeal {
  mealPlanId String
  mealId     String
  mealPlan   MealPlan @relation(fields: [mealPlanId], references: [id], onDelete: Cascade)
  meal       Meal     @relation(fields: [mealId], references: [id], onDelete: Cascade)
  @@id([mealPlanId, mealId])
  @@index([mealId])
}

model Cuisine {
  id               String        @id @default(uuid())
  code             String        @unique   // ITALIAN, INDIAN, KENYAN
  name             String
  description      String?
  status           CuisineStatus @default(ACTIVE)
  deletedAt        DateTime?
  createdByAdminId String?
  updatedByAdminId String?
  createdByAdmin   AdminUser? @relation("CuisineCreatedBy",fields: [createdByAdminId],references: [id])
  updatedByAdmin   AdminUser? @relation("CuisineUpdatedBy",fields: [updatedByAdminId],references: [id])
  primaryVendors   VendorProfile[]
  outlets          OutletCuisine[]
  meals            MealCuisine[]

  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt

  @@index([status])
  @@index([deletedAt])
}

model OutletCuisine {
  outletId   String
  cuisineId  String
  outlet     Outlet  @relation(fields: [outletId], references: [id], onDelete: Cascade)
  cuisine    Cuisine @relation(fields: [cuisineId], references: [id])

  @@id([outletId, cuisineId])
  @@index([cuisineId])
}


//* ----------------------------- GEOGRAPHY -----------------------------

model Country {
  id                  String        @id @default(uuid())
  name                String        @unique
  code                String        @unique
  currency            String
  phoneCode           String
  status              GeoStatus   @default(ACTIVE)
  cities              City[]
  vendorTypes         VendorTypeCountry[]
  documentTypes       DocumentTypeConfig[]
  vendors             VendorAccount[]
  payoutTypes         CountryPayoutType[]
  vendorApplications  VendorApplication[]
  createdByAdminId    String?
  updatedByAdminId    String?
  createdByAdmin      AdminUser?  @relation("CountryCreatedBy", fields: [createdByAdminId], references: [id])
  updatedByAdmin      AdminUser?  @relation("CountryUpdatedBy", fields: [updatedByAdminId], references: [id])
  createdAt           DateTime    @default(now())
  updatedAt           DateTime    @updatedAt

  @@index([status])
}

model City {
  id                String     @id @default(uuid())
  country           Country    @relation(fields: [countryId], references: [id], onDelete: Restrict)
  countryId         String
  name              String
  code              String?
  timezone          String
  latitude          Float?
  longitude         Float?
  status            GeoStatus   @default(ACTIVE)
  stores            Outlet[]
  documentTypes     DocumentTypeConfig[]
  serviceAreas      ServiceArea[]
  createdBy         AdminUser?  @relation("CityCreatedBy", fields: [createdByAdminId], references: [id])
  updatedBy         AdminUser?  @relation("CityUpdatedBy", fields: [updatedByAdminId], references: [id])
  createdByAdminId  String?
  updatedByAdminId  String?
  createdAt         DateTime    @default(now())
  updatedAt         DateTime    @updatedAt

  @@unique([countryId, name])
  @@index([countryId])
  @@index([status])
}

model ServiceArea {
  id                String      @id @default(uuid())
  city              City        @relation(fields: [cityId], references: [id], onDelete: Cascade)
  cityId            String
  name              String
  boundaries        Bytes       @db.Geography
  status            GeoStatus   @default(ACTIVE)
  createdAt         DateTime    @default(now())
  updatedAt         DateTime    @updatedAt
  createdByAdminId  String?
  updatedByAdminId  String?
  createdBy         AdminUser?  @relation("ServiceAreaCreatedBy", fields: [createdByAdminId], references: [id])
  updatedBy         AdminUser?  @relation("ServiceAreaUpdatedBy", fields: [updatedByAdminId], references: [id])
  outlets           OutletServiceArea[]

  @@unique([cityId, name])
  @@index([cityId])
  @@index([status])
}

model OutletServiceArea {
  outletId       String
  serviceAreaId  String
  outlet         Outlet       @relation(fields: [outletId], references: [id], onDelete: Cascade)
  serviceArea    ServiceArea  @relation(fields: [serviceAreaId], references: [id], onDelete: Cascade)

  @@id([outletId, serviceAreaId])
  @@index([serviceAreaId])
}

model VendorTypeCountry {
  id                String      @id @default(uuid())
  country           Country     @relation(fields: [countryId], references: [id], onDelete: Restrict)
  countryId         String
  vendorType        VendorType  @relation(fields: [vendorTypeId], references: [id], onDelete: Restrict)
  vendorTypeId      String
  status            GeoStatus   @default(ACTIVE)
  createdBy         AdminUser?  @relation("VendorTypeCountryCreatedBy", fields: [createdByAdminId], references: [id])
  updatedBy         AdminUser?  @relation("VendorTypeCountryUpdatedBy", fields: [updatedByAdminId], references: [id])
  createdByAdminId  String?
  updatedByAdminId  String?
  createdAt         DateTime    @default(now())
  updatedAt         DateTime    @updatedAt

  @@unique([countryId, vendorTypeId])
  @@index([countryId])
  @@index([vendorTypeId])
  @@index([status])
}

//*---------------------DOCS--------------------------------

model DocumentTypeConfig {
  id                  String          @id @default(uuid())
  name                String   
  code                String
  description         String?
  scope               DocumentScope
  isInheritable       Boolean         @default(false)  //* Only relevant when scope=VENDOR
  country             Country         @relation(fields: [countryId], references: [id], onDelete: Cascade)
  countryId           String
  city                City?           @relation(fields: [cityId], references: [id], onDelete: Cascade)
  cityId              String?         //* Only relevant when scope=STORE
  isRequired          Boolean         @default(true)
  requiresExpiry      Boolean         @default(true)
  expiryWarningDays   Int             @default(30)
  vendorTypeConfigs   DocumentTypeVendorType[]
  instructions        String?
  sampleUrl           String?
  vendorDocuments     VendorDocument[]
  storeDocuments      OutletDocument[]
  status              DocumentTypeStatus @default(ACTIVE)
  createdByAdminId    String?
  updatedByAdminId    String?
  createdByAdmin      AdminUser? @relation("DocumentTypeCreatedBy", fields: [createdByAdminId], references: [id])
  updatedByAdmin      AdminUser? @relation("DocumentTypeUpdatedBy", fields: [updatedByAdminId], references: [id])
  createdAt           DateTime @default(now())
  updatedAt           DateTime @updatedAt

  @@index([countryId])
  @@index([cityId])
  @@unique([code, countryId, cityId])
  @@index([scope, countryId, cityId])
}

model DocumentTypeVendorType {
  id              String              @id @default(uuid())
  documentType    DocumentTypeConfig  @relation(fields: [documentTypeId], references: [id], onDelete: Cascade)
  documentTypeId  String
  vendorType      VendorType          @relation(fields: [vendorTypeId], references: [id], onDelete: Cascade)
  vendorTypeId    String
  isRequired      Boolean             @default(true)
  createdAt       DateTime            @default(now())
  @@unique([documentTypeId, vendorTypeId])
  @@index([documentTypeId])
  @@index([vendorTypeId])
}

model VendorDocument {
  id                    String                @id @default(uuid())
  application           VendorApplication?    @relation(fields: [applicationId], references: [id], onDelete: Cascade)
  applicationId         String?
  vendor                VendorAccount?        @relation(fields: [vendorId], references: [id], onDelete: Cascade)
  vendorId              String?
  documentType          DocumentTypeConfig    @relation(fields: [documentTypeId], references: [id])
  documentTypeId        String
  documentNumber        String?
  storageKey            String
  documentName          String?
  fileSize              Int?
  mimeType              String?
  status                DocumentStatus        @default(PENDING)
  issueDate             DateTime?
  expiryDate            DateTime?
  uploadedAt            DateTime              @default(now())
  reviewedAt            DateTime?
  approvedAt            DateTime?
  rejectedAt            DateTime?
  sourceApplicationId   String?
  reviewedByAdminId     String?
  reviewedByAdmin       AdminUser?            @relation("VendorDocumentReviewedBy", fields: [reviewedByAdminId], references: [id])
  rejectionReason       String?
  revisionNotes         String?
  supersededBy          String?               //* ID of document that replaces this
  supersededAt          DateTime?
  version               Int                   @default(1)
  inheritedByStores     StoreDocumentInheritance[]

  createdAt             DateTime              @default(now())
  updatedAt             DateTime              @updatedAt

  @@index([applicationId])
  @@index([vendorId])
  @@index([documentTypeId])
  @@index([status])
  @@index([expiryDate])

}

model OutletDocument {
  id                  String            @id @default(uuid())
  outlet              Outlet         @relation(fields: [outletId], references: [id], onDelete: Cascade)
  outletId             String
  documentType        DocumentTypeConfig  @relation(fields: [documentTypeId], references: [id])
  documentTypeId      String
  documentNumber      String?
  storageKey          String
  documentName        String?
  fileSize            Int?
  mimeType            String?
  issueDate           DateTime?
  expiryDate          DateTime?
  status              DocumentStatus     @default(PENDING)
  submittedAt         DateTime           @default(now())
  reviewedAt          DateTime?
  approvedAt          DateTime?
  rejectedAt          DateTime?
  reviewedBy          String?
  reviewedByAdmin     AdminUser?         @relation("OutletDocumentReviewedBy", fields: [reviewedBy], references: [id])
  rejectionReason     String?
  revisionNotes       String?

  //* Document versioning
  supersededBy      String?
  supersededAt      DateTime?
  version           Int                @default(1)
  createdAt         DateTime           @default(now())
  updatedAt         DateTime           @updatedAt

  @@unique([outletId, documentTypeId, supersededAt])
  @@index([outletId])
  @@index([documentTypeId])
  @@index([status])
  @@index([expiryDate])
}

//* Track which stores inherit which vendor documents
model StoreDocumentInheritance {
  id                String         @id @default(uuid())
  outlet            Outlet    @relation(fields: [storeId], references: [id], onDelete: Cascade)
  storeId           String
  vendorDocument    VendorDocument @relation(fields: [vendorDocumentId], references: [id], onDelete: Cascade)
  vendorDocumentId  String
  
  documentType      DocumentTypeConfig @relation(fields: [documentTypeId], references: [id])
  documentTypeId    String
  
  inheritedAt       DateTime       @default(now())
  isActive          Boolean        @default(true)
  
  @@unique([storeId, documentTypeId]) // One inheritance per doc type per store
  @@index([storeId])
  @@index([vendorDocumentId])
  @@index([documentTypeId])
}


//*-------------------------VENDORS------------------------------

model VendorType {
  id                  String              @id @default(uuid())
  name                String              @unique
  description         String?
  status              VendorTypeStatus    @default(ACTIVE)
  deletedAt           DateTime?
  countries           VendorTypeCountry[]
  vendorApplications  VendorApplication[]
  createdBy           AdminUser?          @relation("VendorTypeCreatedBy", fields: [createdByAdminId], references: [id])
  updatedBy           AdminUser?          @relation("VendorTypeUpdatedBy", fields: [updatedByAdminId], references: [id])
  createdByAdminId    String?
  updatedByAdminId    String?
  vendorAccounts      VendorAccount[]
  createdAt           DateTime            @default(now())
  updatedAt           DateTime            @updatedAt

  @@index([status])
}

model VendorAccount {
  id                    String                  @id @default(uuid())
  user                  VendorUser?             @relation(fields: [userId], references: [id], onDelete: SetNull)
  userId                String?                 @unique
  vendorType            VendorType              @relation(fields: [vendorTypeId], references: [id])
  vendorTypeId          String
  otherVendorType       String?
  status                VendorStatus            @default(ACTIVE)
  country               Country                 @relation(fields: [countryId], references: [id])
  application           VendorApplication? @relation
  applicationId         String? @unique
  countryId             String
  legalBusinessName     String
  businessEmail         String                  @unique
  businessPhone         String
  companyRegNumber      String?
  taxRegistrationNumber String?
  taxIdType             String?
  ownerFirstName        String
  ownerLastName         String
  ownerPhone            String?
  ownerEmail            String?
  businessAddress       String
  addressLine2          String?
  postalCode            String?
  addressVerified       Boolean                  @default(false)
  suspensionReason      String?
  documents             VendorDocument[]
  outlets               Outlet[]
  payoutAccounts        VendorPayoutAccount[]
  vendorProfile         VendorProfile?
  deactivatedAt         DateTime?
  deletedAt             DateTime?
  suspendedAt           DateTime?
  suspensionUntil       DateTime?
  createdAt             DateTime                @default(now())
  updatedAt             DateTime                @updatedAt

  @@unique([userId, countryId])
  @@unique([companyRegNumber, countryId])
  @@unique([taxRegistrationNumber, countryId])
  @@unique([businessPhone, countryId])
  @@index([userId])
  @@index([countryId])
  @@index([status])
  @@index([businessEmail])
  @@index([businessPhone])
  @@index([createdAt])
  @@index([deletedAt])
  @@index([countryId, status])
}

model VendorProfile {
  id                   String         @id @default(uuid())
  vendorAccount        VendorAccount  @relation(fields: [vendorAccountId], references: [id], onDelete: Cascade)
  vendorAccountId      String         @unique
  displayName          String
  tagline              String?
  description          String?
  story                String?
  logoUrl              String?
  coverImageUrl        String?
  publicEmail          String?
  publicPhone          String?
  website              String?
  socialLinks          Json?
  reservationLink      String?
  primaryCuisineId     String?
  primaryCuisine       Cuisine?       @relation(fields: [primaryCuisineId], references: [id])
  specialties          String[]
  dietaryOptions       String[]
  foundedYear          Int?
  totalReviews         Int            @default(0)
  averageRating        Float          @default(0)
  isVerifiedBadge      Boolean        @default(false)
  isTopRated           Boolean        @default(false)
  isCommunityFavorite  Boolean        @default(false)

  isPublished          Boolean        @default(false)
  isFeatured           Boolean        @default(false)

  galleryImages        String[]
  videoUrls            String[]

  createdAt            DateTime       @default(now())
  updatedAt            DateTime       @updatedAt
  publishedAt          DateTime?
  
  @@index([vendorAccountId])
  @@index([displayName])
  @@index([primaryCuisineId])
  @@index([isPublished])
  @@index([isFeatured])
  @@index([averageRating])
  @@index([createdAt])
  @@index([totalReviews])
}

model VendorApplication {
  id                    String        @id @default(uuid())
  user                  VendorUser?   @relation(fields: [userId], references: [id], onDelete: SetNull)
  userId                String?       @unique
  country               Country       @relation(fields: [countryId], references: [id])
  countryId             String
  vendorType            VendorType    @relation(fields: [vendorTypeId], references: [id])
  vendorTypeId String
  otherVendorType       String?
  legalBusinessName     String
  registrationNumber    String?
  taxId                 String?
  businessEmail         String
  businessPhone         String?
  ownerFirstName        String
  ownerLastName         String
  ownerPhone            String?
  ownerEmail            String?
  businessAddress       String
  addressLine2          String?
  postalCode            String?
  status                VendorApplicationStatus  @default(DRAFT)
  vendorAccountId       String?                  @unique
  vendorAccount         VendorAccount?           @relation(fields: [vendorAccountId], references: [id])
  submittedAt           DateTime?
  reviewedAt            DateTime?
  approvedAt            DateTime?
  approvedBy            String?
  reviewedBy            String?  
  revisionCount         Int                     @default(0)
  rejectionReason       String?
  revisionNotes         String?
  documents             VendorDocument[]  
  createdAt             DateTime                 @default(now())
  updatedAt             DateTime                 @updatedAt

  @@unique([userId, countryId], name: "application_user_country_unique")
  @@index([status])
  @@index([countryId])
}

//*-----------------------------PAYOUTS------------------------------

model PayoutType {
  id                String           @id @default(uuid())
  code              String           @unique // BANK_TRANSFER, MOBILE_MONEY, PAYPAL
  name              String
  description       String?
  status            PayoutTypeStatus @default(ACTIVE)
  deletedAt         DateTime?
  countries         CountryPayoutType[]
  createdByAdminId  String?
  updatedByAdminId  String?
  createdByAdmin    AdminUser? @relation("PayoutTypeCreatedBy", fields: [createdByAdminId], references: [id])
  updatedByAdmin    AdminUser? @relation("PayoutTypeUpdatedBy", fields: [updatedByAdminId], references: [id])
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  @@index([status])
}

model CountryPayoutType {
  id                String      @id @default(uuid())
  country           Country     @relation(fields: [countryId], references: [id], onDelete: Restrict)
  countryId         String
  payoutType        PayoutType  @relation(fields: [payoutTypeId], references: [id], onDelete: Restrict)
  payoutTypeId      String
  status            GeoStatus   @default(ACTIVE)
  //* Optional country-specific configuration
  currency          String?
  minPayoutAmount   Float?
  maxPayoutAmount   Float?
  processingDays    Int?
  createdByAdminId  String?
  updatedByAdminId  String?
  createdByAdmin    AdminUser?  @relation("CountryPayoutTypeCreatedBy", fields: [createdByAdminId], references: [id])
  updatedByAdmin    AdminUser?  @relation("CountryPayoutTypeUpdatedBy", fields: [updatedByAdminId], references: [id])
  createdAt         DateTime    @default(now())
  updatedAt         DateTime    @updatedAt

  @@unique([countryId, payoutTypeId])
  @@index([countryId])
  @@index([payoutTypeId])
  @@index([status])
}

model VendorPayoutAccount {
  id                    String               @id @default(uuid())
  vendor                VendorAccount        @relation(fields: [vendorId], references: [id], onDelete: Cascade)
  vendorId              String
  countryPayoutType     CountryPayoutType    @relation(fields: [countryPayoutTypeId], references: [id], onDelete: Restrict)
  countryPayoutTypeId   String
  isDefault             Boolean              @default(false)
  // -------- Bank Transfer --------
  bankName              String?
  branchName            String?
  bankCode              String?
  accountNumber         String?
  accountName           String?
  swiftCode             String?
  iban                  String?
  routingNumber         String?

  // -------- Mobile Money --------
  mobileNetwork         String?
  mobileNumber          String?
  mobileWallet          String?

  // -------- Platform Accounts --------
  paypalEmail           String?
  stripeAccountId       String?

  isVerified            Boolean              @default(false)
  verifiedAt            DateTime?
  verificationSource    String? // STRIPE, PAYPAL, MANUAL, MOBILE_PROVIDER
  isActive              Boolean              @default(true)
  deletedAt             DateTime?
  createdAt             DateTime             @default(now())
  updatedAt             DateTime             @updatedAt

  @@index([vendorId])
  @@index([countryPayoutTypeId])
  @@index([isActive])
}

//*------------------------------OUTLETS-----------------------------

model Outlet {
  id             String             @id @default(uuid())
  vendor         VendorAccount      @relation(fields: [vendorId], references: [id], onDelete: Cascade)
  vendorId       String
  name           String
  slug           String?            @unique
  avatar         String?
  bio            String?
  coverBanner    String?
  images         String[]
  city           City               @relation(fields: [cityId], references: [id])
  cityId         String
  addressLine1   String
  addressLine2   String?
  postalCode     String?
  neighborhood   String?
  latitude       Float
  longitude      Float
  deliveryRadius Float?
  deliveryZones  Json?
  deliveryFee    Float?
  minimumOrder   Float?
  phone          String?
  email          String?
  isMainStore    Boolean            @default(false)
  cuisines       OutletCuisine[]
  mealIds        Int[]
  mealPlanIds    Int[]
  ratings        Float                 @default(0)
  totalReviews   Int                   @default(0)
  isFeatured     Boolean               @default(false)
  operatingHours OutletOperatingHours[]
  documents      OutletDocument[]
  serviceAreas   OutletServiceArea[]

  //* ---------------- ADMIN AUTHORITY ----------------
  adminStatus         OutletAdminStatus      @default(ACTIVE)
  adminSuspendedAt    DateTime?
  adminSuspendUntil   DateTime?
  adminBannedAt       DateTime?
  adminUpdatedAt      DateTime?
  adminUpdatedById    String?
  adminUpdatedBy      AdminUser?        @relation("OutletUpdatedByAdmin", fields: [adminUpdatedById], references: [id])

  //* ---------------- VENDOR INTENT ----------------
  vendorDisabledAt    DateTime?
  deletedAt           DateTime?
  vendorUpdatedAt     DateTime?
  createdAt           DateTime               @default(now())
  updatedAt           DateTime               @updatedAt

  @@unique([vendorId, name])
  @@index([vendorId])
  @@index([cityId])
  @@index([slug])
  @@index([adminStatus])
  @@index([latitude, longitude])
}


model OutletOperatingHours {
  id          String      @id  @default(uuid())
  outlet       Outlet      @relation(fields: [outletId], references: [id], onDelete: Cascade)
  outletId    String
  dayOfWeek   DayOfWeek
  openTime    String
  closeTime   String
  isClosed    Boolean     @default(false)
  isActive    Boolean     @default(true)
  validFrom   DateTime?
  validUntil  DateTime?

  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt

  @@unique([outletId, dayOfWeek, validFrom])
  @@index([outletId])
}


//*-----------------------------LOGS--------------------------------------
model OutletAdminActivityLog {
  id                String   @id @default(uuid())
  outlet            Outlet   @relation(fields: [outletId], references: [id], onDelete: Cascade)
  outletId          String
  admin             AdminUser @relation(fields: [adminId], references: [id])
  adminId           String
  action            OutletAdminActionType
  reasonId          String?
  reason            OutletAdminActionReason? @relation(fields: [reasonId], references: [id])
  otherReason       String?
  previousStatus    OutletAdminStatus?
  newStatus         OutletAdminStatus?
  createdAt         DateTime @default(now())

  @@index([outletId])
  @@index([adminId])
  @@index([action])
  @@index([createdAt])
}

model OutletAdminActionReason {
  id          String   @id @default(uuid())
  code        String   @unique
  label       String
  description String?
  appliesTo   OutletAdminActionType[]
  isActive    Boolean  @default(true)

  createdAt  DateTime @default(now())
}
